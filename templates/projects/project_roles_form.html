{% extends "base.html" %}
{% block content %}
<h2>Manage Project Roles</h2>

<form method="post">
    {% csrf_token %}
    {{ formset.management_form }}

    {% if formset.non_form_errors %}
        <div class="alert alert-danger">
            <ul>
                {% for error in formset.non_form_errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>User</th>
                <th>Role</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
        {% for member_form in formset %}
            {% if member_form.errors %}
                <tr>
                    <td colspan="3" class="alert alert-warning">
                        <ul>
                            {% for field, errors in member_form.errors.items %}
                                <li>{{ field }}: {% for error in errors %}{{ error }}{% endfor %}</li>
                            {% endfor %}
                        </ul>
                    </td>
                </tr>
            {% endif %}
            <tr>
                <td>
                    {{ member_form.instance.user.username|default:"No user" }}
                    {{ member_form.user.as_hidden }}
                    {{ member_form.id }}
                </td>
                <td>{{ member_form.role }}</td>
                <td>
                    {{ member_form.DELETE }}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <button type="submit" class="btn btn-primary">Save Roles</button>
</form>

{% endblock %}