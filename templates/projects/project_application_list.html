{% extends "base.html" %}
{% block content %}

  {% if messages %}
  <div class="container mt-3">
    {% for message in messages %}
      <div class="alert
        {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %}
        alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<div class="d-grid gap-3" style="grid-template-columns: 1fr 3fr;">
  <div class="bg-body-tertiary border rounded-3 sticky-top"
     style="padding: 15px; height: fit-content; top: 20px;">
      <a href="{% url 'projects:project_detail' project.pk %}" class="btn btn-primary" style="width: 100%;">Back to Project</a>
    <form action="" method="get" style="margin-top: 15px;">
      {{ search_form }}
        <button type="submit" class="btn btn-primary mb-3" style="margin-top: 15px; width: 100%;">Find Cndidate</button>
    </form>
  </div>

  <div class="bg-body-tertiary border rounded-3 p-3">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">All Applications</h2>

        <div>
          {% if view_type == 'active' %}
            <a href="{% url 'projects:application_archive' project.pk %}" class="btn btn-secondary">Archive</a>
          {% elif view_type == 'archive' %}
            <a href="{% url 'projects:applications_list' project.pk %}" class="btn btn-secondary">Back to Active</a>
          {% endif %}
        </div>
      </div>

    {% if applications %}
      <ul class="list-group">
        {% for application in applications %}
        <div class="card mb-3 position-relative shadow-sm border-0">
          <div style="position: absolute; top: 10px; right: 10px;">
            {% if application.status == 'approved' %}
              <span class="inline-flex items-center bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                <span class="w-2 h-2 me-1 bg-green-500 rounded-full"></span>
                Approved
              </span>
            {% elif application.status == 'rejected' %}
              <span class="inline-flex items-center bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                <span class="w-2 h-2 me-1 bg-red-500 rounded-full"></span>
                Rejected
              </span>
            {% else %}
              <span class="inline-flex items-center bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                <span class="w-2 h-2 me-1 bg-yellow-500 rounded-full"></span>
                Pending
              </span>
            {% endif %}
          </div>

          <div class="card-body d-flex flex-column">
            <h5 class="card-title mb-1">
              ðŸ‘¤ {{ application.user.username }} â€“
              <a href="{% url 'users:profile' application.user.pk %}"
                 class="text-secondary text-decoration-underline"
                 style="font-size: 0.95rem;">
                Check Profile
              </a>
            </h5>

            <h6 class="text-muted mb-2">
              Role: {{ application.role.role_name }}
            </h6>

            {% if application.message %}
              <p class="card-text text-secondary">{{ application.message }}</p>
            {% endif %}

            {% if view_type == 'active' %}
              <div class="mt-3 d-flex justify-content-end gap-2">
                <a href="{% url 'projects:application_reject' project.pk application.pk %}" class="btn btn-danger">
                  Reject
                </a>
                <a href="{% url 'projects:application_approve' project.pk application.pk %}" class="btn btn-success">
                  Approve
                </a>
              </div>
            {% endif %}
          </div>
        </div>
      {% endfor %}

      </ul>
    {% else %}
      <h4>No applications yet.</h4>
    {% endif %}
    {% include "includes/pagination.html" %}
  </div>
</div>


{% endblock %}
